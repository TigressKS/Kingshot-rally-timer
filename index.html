<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kingshot Rally Timer (UTC)</title>

<style>
:root{
  --bg:#0b1020;
  --card:#ffffff;
  --border:#d1d5db;
  --text:#111827;
  --muted:#6b7280;
  --danger:#b00020;
  --danger-bg:#ffe9ec;
}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#f3f4f6;
  color:var(--text);
}

.banner{
  background:linear-gradient(120deg,#0b1020,#1f2a5c,#0b1020);
  padding:28px 16px;
  text-align:center;
}

.banner h1{
  margin:0;
  font-size:36px;
  font-weight:900;
  letter-spacing:.04em;
  text-transform:uppercase;
  background:linear-gradient(90deg,#ffd166,#ff4d6d,#7c3aed);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}

.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:16px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}

label{
  font-weight:700;
  display:block;
  margin:8px 0 4px;
}

input{
  width:100%;
  padding:8px;
  border:1px solid var(--border);
  border-radius:10px;
  font-size:14px;
}

.grid{
  display:grid;
  gap:12px;
  grid-template-columns:1fr;
}
@media(min-width:900px){
  .grid{ grid-template-columns:1.2fr 1fr 1fr 1.2fr; }
}

.timeRow{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:6px;
}
.timeRow input{ text-align:center; }

button{
  padding:8px 12px;
  border:none;
  border-radius:10px;
  font-size:14px;
  cursor:pointer;
}
.primary{ background:#111827; color:#fff; }
.ghost{ background:#eef2f7; }
.danger{ background:var(--danger-bg); color:var(--danger); }

.btns{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:12px;
}

.allyHead{
  display:flex;
  gap:8px;
  align-items:center;
}

.players{
  margin-top:8px;
  display:flex;
  flex-direction:column;
  gap:6px;
}

.playerHeader{
  display:grid;
  grid-template-columns:1.6fr 1fr auto;
  font-size:12px;
  font-weight:700;
  color:var(--muted);
}

.playerRow{
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px;
}

.playerRow.collision{
  background:#fff4f6;
  border-color:rgba(176,0,32,.35);
}

.playerGrid{
  display:grid;
  grid-template-columns:1.6fr 1fr auto;
  gap:8px;
  align-items:center;
}

.marchWrap{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
}
.marchWrap input{ text-align:center; }

.meta{
  margin-top:4px;
  font-size:12px;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
}

.out{
  white-space:pre-wrap;
  background:#f8fafc;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size:13px;
}
</style>
</head>

<body>

<div class="banner">
  <h1>Kingshot Rally Timer</h1>
</div>

<div class="wrap">

<div class="card">
  <div class="grid">
    <div>
      <label>Target</label>
      <input id="title" value="Turret 4">
    </div>

    <div>
      <label>Baseline UTC</label>
      <div class="timeRow">
        <input id="baseH" placeholder="H">
        <input id="baseM" placeholder="M">
        <input id="baseS" placeholder="S">
      </div>
    </div>

    <div>
      <label>Hit spacing (seconds)</label>
      <input id="spacing" placeholder="e.g. 11">
    </div>

    <div>
      <label>Alliance order (optional)</label>
      <input id="order">
    </div>
  </div>

  <label>Who hits last (optional)</label>
  <input id="lastHit">

  <div class="btns">
    <button class="ghost" id="addAlliance">+ Add alliance</button>
    <button class="primary" id="generate">Generate</button>
    <button class="ghost" id="copy">Copy</button>
  </div>
</div>

<div id="alliances"></div>

<div class="card">
  <div class="out" id="output"></div>
</div>

</div>

<script>
const $ = id => document.getElementById(id);
const pad = n => String(n).padStart(2,"0");

function readNum(el){
  el.value = el.value.replace(/\D/g,"");
  return Number(el.value||0);
}

function hms(sec){
  sec=((sec%86400)+86400)%86400;
  return pad(Math.floor(sec/3600))+":"+pad(Math.floor(sec%3600/60))+":"+pad(sec%60);
}

function addAlliance(){
  const box=document.createElement("div");
  box.className="card";
  box.innerHTML=`
    <div class="allyHead">
      <input class="tag" placeholder="Alliance tag">
      <button class="danger remove">Remove</button>
    </div>

    <div class="playerHeader">
      <div>Name</div>
      <div>March time</div>
      <div></div>
    </div>

    <div class="players"></div>
    <button class="ghost addPlayer">+ Add player</button>
  `;

  const players=box.querySelector(".players");

  function addPlayer(){
    const row=document.createElement("div");
    row.className="playerRow";
    row.innerHTML=`
      <div class="playerGrid">
        <input class="name" placeholder="Name">
        <div class="marchWrap">
          <input class="m" placeholder="M">
          <input class="s" placeholder="S">
        </div>
        <button class="danger rm">✕</button>
      </div>
      <div class="meta">
        <span>Start: <b>--:--:--</b></span>
        <span>Status: —</span>
      </div>
    `;
    row.querySelector(".rm").onclick=()=>row.remove();
    players.appendChild(row);
  }

  box.querySelector(".addPlayer").onclick=addPlayer;
  box.querySelector(".remove").onclick=()=>box.remove();
  addPlayer();
  $("alliances").appendChild(box);
}

function generate(){
  document.querySelectorAll(".playerRow").forEach(r=>r.classList.remove("collision"));

  const base = readNum(baseH)*3600 + readNum(baseM)*60 + readNum(baseS);
  const spacing = readNum(spacing);
  if(spacing<=0) return;

  const out=[];
  out.push(`=== Rally Timings for ${title.value} ===`);
  out.push(`Baseline Time: ${hms(base)} (UTC)`);

  const timeMap={};

  document.querySelectorAll("#alliances .card").forEach(a=>{
    const tag=a.querySelector(".tag").value;
    if(!tag) return;

    const list=[];
    a.querySelectorAll(".playerRow").forEach(p=>{
      const name=p.querySelector(".name").value;
      const m=readNum(p.querySelector(".m"));
      const s=readNum(p.querySelector(".s"));
      if(name) list.push({name,sec:m*60+s,row:p});
    });

    list.sort((a,b)=>b.sec-a.sec);

    list.forEach((p,i)=>{
      const start=hms(base-(list.length-1-i)*spacing-p.sec);
      out.push(`(${tag}) ${p.name}: ${start} UTC`);
      if(!timeMap[start]) timeMap[start]=[];
      timeMap[start].push(p);
      p.row.querySelector(".meta b").textContent=start;
    });

    out.push("");
  });

  Object.values(timeMap).forEach(arr=>{
    if(arr.length>1) arr.forEach(p=>p.row.classList.add("collision"));
  });

  output.textContent=out.join("\n");
}

addAlliance();
addAlliance.onclick=addAlliance;
generate.onclick=generate;
copy.onclick=()=>navigator.clipboard.writeText(output.textContent);
</script>

</body>
</html>
