<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kingshot Rally Timer (UTC)</title>

<style>
:root{
  --bg-dark:#0b1020;
  --bg-light:#f3f4f6;
  --card:#ffffff;
  --border:#d1d5db;
  --text:#111827;
  --muted:#6b7280;
  --danger:#b00020;
  --danger-bg:#ffe9ec;
  --ok:#065f46;
  --ok-bg:#ecfdf5;
}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:var(--bg-light);
  color:var(--text);
}

.banner{
  background:
    linear-gradient(120deg,#0b1020,#1f2a5c,#0b1020);
  padding:28px 16px;
  text-align:center;
  border-bottom:1px solid rgba(255,255,255,.08);
}

.banner h1{
  margin:0;
  font-size:36px;
  font-weight:900;
  letter-spacing:.04em;
  text-transform:uppercase;
  background:linear-gradient(90deg,#ffd166,#ff4d6d,#7c3aed);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}

.banner p{
  margin-top:8px;
  font-size:15px;
  color:rgba(255,255,255,.85);
}

.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:16px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.06);
}

label{
  font-weight:700;
  display:block;
  margin:10px 0 6px;
}

input{
  width:100%;
  padding:10px;
  border:1px solid var(--border);
  border-radius:12px;
  font-size:15px;
}

.grid{
  display:grid;
  gap:12px;
  grid-template-columns:1fr;
}
@media(min-width:900px){
  .grid{ grid-template-columns:1.2fr 1fr 1fr 1.2fr; }
}

.timeRow{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}
.timeRow input{ text-align:center; }

.btns{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:14px;
}

button{
  padding:10px 14px;
  border:none;
  border-radius:12px;
  font-size:15px;
  cursor:pointer;
}
.primary{ background:#111827; color:white; }
.ghost{ background:#eef2f7; }
.danger{ background:var(--danger-bg); color:var(--danger); }

.status{ font-size:13px; color:var(--muted); }

.messages{
  margin-top:10px;
  font-size:13px;
}
.messages.warn{
  background:var(--danger-bg);
  color:var(--danger);
  border-radius:12px;
  padding:10px;
}
.messages.ok{
  background:var(--ok-bg);
  color:var(--ok);
  border-radius:12px;
  padding:10px;
}

.allyHead{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}

.players{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.playerRow{
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
}

.playerGrid{
  display:grid;
  grid-template-columns:1.6fr .6fr .6fr .6fr auto;
  gap:8px;
}

.playerGrid input{ text-align:center; }
.playerGrid input.pName{ text-align:left; }

.playerRow.collision{
  background:#fff4f6;
  border-color:rgba(176,0,32,.35);
}

.meta{
  margin-top:6px;
  font-size:12px;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
}

.out{
  white-space:pre-wrap;
  background:#f8fafc;
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}
</style>
</head>

<body>
<div class="banner">
  <h1>Kingshot Rally Timer</h1>
  <p>UTC-based sequential rally timing calculator</p>
</div>

<div class="wrap">

<div class="card">
  <div class="grid">
    <div>
      <label>Target name</label>
      <input id="title" value="Turret 4">
    </div>

    <div>
      <label>Baseline time (UTC)</label>
      <div class="timeRow">
        <input id="baseH" placeholder="H">
        <input id="baseM" placeholder="M">
        <input id="baseS" placeholder="S">
      </div>
    </div>

    <div>
      <label>Hit spacing</label>
      <div class="timeRow">
        <input id="spaceH" placeholder="H">
        <input id="spaceM" placeholder="M">
        <input id="spaceS" placeholder="S">
      </div>
    </div>

    <div>
      <label>Alliance order (optional)</label>
      <input id="order" placeholder="war, dth, avr">
    </div>
  </div>

  <label>Who hits last (optional)</label>
  <input id="lastHit" placeholder="war=Killian; avr=Lia">

  <div class="btns">
    <button class="ghost" id="addAlliance">+ Add alliance</button>
    <button class="primary" id="generate">Generate</button>
    <button class="ghost" id="copy">Copy output</button>
    <button class="danger" id="clear">Clear</button>
    <span class="status" id="status"></span>
  </div>

  <div id="messages" class="messages"></div>
</div>

<div class="card">
  <div id="alliances"></div>
</div>

<div class="card">
  <div class="out" id="output"></div>
</div>

</div>

<script>
const $ = id => document.getElementById(id);
const pad = n => String(n).padStart(2,"0");
const toSec = (h,m,s)=>h*3600+m*60+s;

function read(el,max=2){
  el.value = el.value.replace(/\D/g,"").slice(0,max);
  return Number(el.value||0);
}

function hmsStr(sec){
  sec=((sec%86400)+86400)%86400;
  return pad(Math.floor(sec/3600))+":"+pad(Math.floor(sec%3600/60))+":"+pad(sec%60);
}

function addAlliance(){
  const box=document.createElement("div");
  box.className="card";
  box.innerHTML=`
    <div class="allyHead">
      <input class="tag" placeholder="Alliance tag">
      <button class="danger remove">Remove</button>
    </div>
    <div class="players"></div>
    <button class="ghost addPlayer">+ Add player</button>
  `;
  const players=box.querySelector(".players");

  function addPlayer(){
    const row=document.createElement("div");
    row.className="playerRow";
    row.innerHTML=`
      <div class="playerGrid">
        <input class="pName" placeholder="Name">
        <input class="pH" placeholder="H">
        <input class="pM" placeholder="M">
        <input class="pS" placeholder="S">
        <button class="danger rm">✕</button>
      </div>
      <div class="meta">
        <span>Start: <b>--:--:--</b></span>
        <span>Status: —</span>
      </div>
    `;
    row.querySelector(".rm").onclick=()=>row.remove();
    players.appendChild(row);
  }

  box.querySelector(".addPlayer").onclick=addPlayer;
  box.querySelector(".remove").onclick=()=>box.remove();
  addPlayer();
  $("alliances").appendChild(box);
}

function generate(){
  const base=toSec(read(baseH),read(baseM),read(baseS));
  const spacing=toSec(read(spaceH),read(spaceM),read(spaceS));
  if(spacing<=0){ $("messages").className="messages warn"; $("messages").textContent="Hit spacing must be > 0"; return; }

  const out=[];
  out.push(`=== Rally Timings for ${title.value} ===`);
  out.push(`Baseline Time: ${hmsStr(base)} (UTC)`);

  document.querySelectorAll(".playerRow").forEach(r=>r.classList.remove("collision"));

  const map={};
  document.querySelectorAll(".card .card").forEach(()=>{});

  const groups=[];
  document.querySelectorAll("#alliances .card").forEach(a=>{
    const tag=a.querySelector(".tag").value;
    if(!tag) return;
    const list=[];
    a.querySelectorAll(".playerRow").forEach(p=>{
      const name=p.querySelector(".pName").value;
      const sec=toSec(read(p.querySelector(".pH")),read(p.querySelector(".pM")),read(p.querySelector(".pS")));
      if(name && sec>0) list.push({tag,name,sec,row:p});
    });
    if(list.length) groups.push({tag,list});
  });

  groups.forEach(g=>{
    g.list.sort((a,b)=>b.sec-a.sec);
    g.list.forEach((p,i)=>{
      const start=hmsStr(base - (g.list.length-1-i)*spacing - p.sec);
      out.push(`(${g.tag}) ${p.name}: ${start} UTC`);
      if(!map[start]) map[start]=[];
      map[start].push(p);
      p.row.querySelector(".meta").children[0].innerHTML=`Start: <b>${start}</b>`;
    });
    out.push("");
  });

  Object.values(map).forEach(list=>{
    if(list.length>1) list.forEach(p=>p.row.classList.add("collision"));
  });

  output.textContent=out.join("\n");
}

addAlliance();
addAlliance.onclick=addAlliance;
generate.onclick=generate;
copy.onclick=()=>navigator.clipboard.writeText(output.textContent);
clear.onclick=()=>location.reload();
</script>
</body>
</html>
